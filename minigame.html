<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BD Clan Clicker Minigame</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Animation classes */
        @keyframes hit {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes death {
            0% { opacity: 1; transform: scale(1) rotate(0deg); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
        
        @keyframes respawn {
            0% { opacity: 0; transform: scale(0) rotate(-360deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        
        .hit-animation {
            animation: hit 0.3s ease;
        }
        
        .death-animation {
            animation: death 0.5s ease forwards;
        }
        
        .respawn-animation {
            animation: respawn 0.5s ease forwards;
        }
        
        /* Custom styles */
        .demon-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .demon-text {
            color: #ff4d4d;
        }
        
        .demon-card {
            background-color: #16213e;
            border-left: 4px solid #ff4d4d;
        }
        
        .demon-btn {
            background-color: #ff4d4d;
            color: white;
        }
        
        .demon-btn:hover {
            background-color: #ff1a1a;
        }
        
        .target {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .target:hover {
            transform: scale(1.05);
        }
        
        .progress-bar {
            height: 20px;
            background-color: #1a1a2e;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4d4d, #ff1a1a);
            transition: width 0.3s ease;
        }
        
        .kill-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff4d4d;
            text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .stats-table th, .stats-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #2d3748;
        }
        
        .stats-table th {
            background-color: #1a1a2e;
            color: #ff4d4d;
        }
        
        .stats-table tr:hover {
            background-color: #2d3748;
        }
    </style>
     <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
     <!-- Navigation Menu -->
    <nav class="navbar fixed top-0 w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <span class="text-xl font-bold demon-text">AOH - BD Clan</span>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-center space-x-4">
                        <a href="index.html" class="nav-link text-white" onclick="showMainMenu()">
                            <i class="fas fa-home mr-1"></i> Home
                        </a>
                        <a href="#" class="nav-link text-white" onclick="showAdminAccess()">
                            <i class="fas fa-lock mr-1"></i> Admin
                        </a>
                        <a href="minigame.html" class="nav-link text-white" onclick="showAdminNote()">
                            <i class="fas fa-info-circle mr-1"></i> MiniGame
                        </a>
                    </div>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-white hover:text-red-400 focus:outline-none">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="mobile-menu md:hidden bg-gray-900" style="display: none;">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-gray-800" onclick="showMainMenu(); toggleMobileMenu()">
                    <i class="fas fa-home mr-2"></i> Home
                </a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-gray-800" onclick="showAdminAccess(); toggleMobileMenu()">
                    <i class="fas fa-lock mr-2"></i> Admin
                </a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-gray-800" onclick="showAdminNote(); toggleMobileMenu()">
                    <i class="fas fa-info-circle mr-2"></i> MiniGame
                </a>
            </div>
        </div>
    </nav>
<!-- Filters and Killer Selector -->
    <div class="mb-4">
        <label for="level-filter" class="block mb-1 font-semibold">Filter by Level:</label>
        <select id="level-filter" class="text-black p-2 rounded w-full">
            <option value="all">All Levels</option>
        </select>
    </div>

    <div class="mb-4">
        <label for="sort-method" class="block mb-1 font-semibold">Sort:</label>
        <select id="sort-method" class="text-black p-2 rounded w-full">
            <option value="default">Sort: Default</option>
            <option value="level-asc">Sort: Level (Low → High)</option>
            <option value="level-desc">Sort: Level (High → Low)</option>
            <option value="name-asc">Sort: Name (A → Z)</option>
        </select>
    </div>

    <div class="mb-4">
        <label for="killer-select" class="block mb-1 font-semibold">Select Killer:</label>
        <select id="killer-select" class="text-black p-2 rounded w-full">
            <option value="" disabled selected>Loading...</option>
        </select>
    </div>

    <button id="export-members" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mb-4 hidden">
      Export Members List
    </button>

    <script>
        const gameState = {
            targets: {
                Zen: { health: 100, maxHealth: 100 },
                Kyle: { health: 100, maxHealth: 100 },
                Levi: { health: 100, maxHealth: 100 },
                Ban: { health: 100, maxHealth: 100 }
            },
            stats: {
                totalKills: 0,
                zenKills: 0,
                kyleKills: 0,
                leviKills: 0,
                banKills: 0,
                killDetails: {}
            },
            currentKiller: "Keen"
        };

        const firebaseConfig = {
            apiKey: "AIzaSyBDgadn_l0VLJmgCPzziGbwbXYaIfhn0vQ",
            authDomain: "aoh-bd-clan.firebaseapp.com",
            databaseURL: "https://aoh-bd-clan-default-rtdb.firebaseio.com/",
            projectId: "aoh-bd-clan",
            storageBucket: "aoh-bd-clan.firebasestorage.app",
            messagingSenderId: "824398865971",
            appId: "1:824398865971:web:139890878f47e251ad6546",
            measurementId: "G-4V15NCH2RH"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function initGame() {
            loadStats(stats => {
                if (stats) {
                    Object.assign(gameState.stats, stats);
                }
                updateStatsUI();
                renderKillDetails();
            });

            loadMemberList();
        }

        function loadMemberList() {
            const killerSelect = document.getElementById('killer-select');
            const filterSelect = document.getElementById('level-filter');
            const sortSelect = document.getElementById('sort-method');
            const exportBtn = document.getElementById('export-members');
            const membersRef = database.ref('clanData/members');

            let allMembers = [];

            function populateFilterOptions() {
                for (let min = 0; min < 20000; min += 1000) {
                    const max = min + 1000;
                    const option = document.createElement('option');
                    option.value = `${min}-${max}`;
                    option.textContent = `${min}-${max}`;
                    filterSelect.appendChild(option);
                }
            }

            function updateKillerDropdown(filteredMembers) {
                killerSelect.innerHTML = '';

                if (filteredMembers.length === 0) {
                    const opt = document.createElement('option');
                    opt.textContent = 'No members found';
                    killerSelect.appendChild(opt);
                    return;
                }

                filteredMembers.forEach(member => {
                    const option = document.createElement('option');
                    option.value = member.username;
                    option.textContent = `${member.username} (${member.level})`;
                    killerSelect.appendChild(option);
                });

                if (gameState.currentKiller) {
                    killerSelect.value = gameState.currentKiller;
                }
            }

            function applyFilter() {
                const selectedRange = filterSelect.value;
                localStorage.setItem('bd-level-filter', selectedRange);

                let filtered = allMembers;

                if (selectedRange !== "all") {
                    const [min, max] = selectedRange.split('-').map(Number);
                    filtered = filtered.filter(m => m.level >= min && m.level < max);
                }

                const sortValue = sortSelect.value;
                filtered.sort((a, b) => {
                    switch (sortValue) {
                        case 'level-asc': return a.level - b.level;
                        case 'level-desc': return b.level - a.level;
                        case 'name-asc': return a.username.localeCompare(b.username);
                        default: return 0;
                    }
                });

                updateKillerDropdown(filtered);
            }

            filterSelect.addEventListener('change', applyFilter);
            sortSelect.addEventListener('change', applyFilter);

            membersRef.once('value').then(snapshot => {
                const members = snapshot.val();
                if (!Array.isArray(members)) return;

                allMembers = members;
                populateFilterOptions();

                const savedFilter = localStorage.getItem('bd-level-filter');
                if (savedFilter) {
                    filterSelect.value = savedFilter;
                }

                applyFilter();

                // Show export button if admin
                database.ref('clanData/adminKey').once('value').then(snapshot => {
                    const adminKey = snapshot.val();
                    if (gameState.currentKiller === adminKey) {
                        exportBtn.classList.remove('hidden');
                    }
                });

                exportBtn.addEventListener('click', () => {
                    const blob = new Blob([JSON.stringify(allMembers, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'bd_clan_members.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                });
            });

            killerSelect.addEventListener('change', function () {
                gameState.currentKiller = this.value;
            });
        }

        function attack(targetName) {
            const target = gameState.targets[targetName];
            if (!target) return;

            const damage = Math.floor(Math.random() * 11) + 5;
            target.health = Math.max(0, target.health - damage);
            updateTargetUI(targetName);

            const targetElement = document.getElementById(`${targetName.toLowerCase()}-target`);
            targetElement.classList.add('hit-animation');
            setTimeout(() => {
                targetElement.classList.remove('hit-animation');
            }, 300);

            if (target.health <= 0) {
                killTarget(targetName);
            }
        }

        function updateTargetUI(targetName) {
            const target = gameState.targets[targetName];
            const healthPercent = (target.health / target.maxHealth) * 100;
            document.getElementById(`${targetName.toLowerCase()}-health`).style.width = `${healthPercent}%`;
            document.getElementById(`${targetName.toLowerCase()}-health-text`).textContent = target.health;
        }

        function killTarget(targetName) {
            const targetElement = document.getElementById(`${targetName.toLowerCase()}-target`);
            targetElement.classList.add('death-animation');

            gameState.stats.totalKills++;
            gameState.stats[`${targetName.toLowerCase()}Kills`]++;

            const killerVictimKey = `${gameState.currentKiller}-${targetName}`;
            gameState.stats.killDetails[killerVictimKey] = (gameState.stats.killDetails[killerVictimKey] || 0) + 1;

            updateStatsUI();
            renderKillDetails();
            saveStats();

            setTimeout(() => {
                gameState.targets[targetName].health = gameState.targets[targetName].maxHealth;
                updateTargetUI(targetName);
                targetElement.classList.remove('death-animation');
                targetElement.classList.add('respawn-animation');
                setTimeout(() => {
                    targetElement.classList.remove('respawn-animation');
                }, 500);
            }, 1000);
        }

        function updateStatsUI() {
            document.getElementById('total-kills').textContent = gameState.stats.totalKills;
            document.getElementById('zen-kills').textContent = gameState.stats.zenKills;
            document.getElementById('kyle-kills').textContent = gameState.stats.kyleKills;
            document.getElementById('levi-kills').textContent = gameState.stats.leviKills;
            document.getElementById('ban-kills').textContent = gameState.stats.banKills;
        }

        function renderKillDetails() {
            const tbody = document.getElementById('kill-details');
            if (!tbody) return;
            tbody.innerHTML = '';
            for (const key in gameState.stats.killDetails) {
                const [killer, victim] = key.split('-');
                const count = gameState.stats.killDetails[key];
                const row = `<tr><td>${killer}</td><td>${victim}</td><td>${count}</td></tr>`;
                tbody.innerHTML += row;
            }
        }

        function saveStats() {
            database.ref('minigameStats').set(gameState.stats);
        }

        function loadStats(callback) {
            database.ref('minigameStats').once('value').then(snapshot => {
                callback(snapshot.val());
            });
        }

        function resetStats() {
            if (!confirm('Are you sure you want to reset all stats?')) return;
            gameState.stats = {
                totalKills: 0,
                zenKills: 0,
                kyleKills: 0,
                leviKills: 0,
                banKills: 0,
                killDetails: {}
            };
            updateStatsUI();
            renderKillDetails();
            saveStats();
        }

        function exportStats() {
            const dataStr = JSON.stringify(gameState.stats, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "minigame_stats.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        window.onload = initGame;
    </script>
</body>
</html>
