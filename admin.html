<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BD Clan Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #1a1a2e;
      color: white;
    }
    button {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 8px 16px;
      margin: 5px;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #ff1a1a;
    }
    input, select {
      background-color: #0f0f2e;
      color: white;
      border: 1px solid #ff4d4d;
      padding: 8px;
      border-radius: 4px;
      margin: 5px 0;
    }
    hr {
      border-color: #ff4d4d;
      margin: 20px 0;
    }
    .error-message {
      color: #ff4d4d;
      margin: 10px 0;
    }
    .login-container {
      max-width: 400px;
      margin: 100px auto;
      text-align: center;
    }
    .login-input {
      width: 100%;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="login-container" class="login-container">
    <h1>BD Clan Admin Login</h1>
    <input type="password" id="admin-key" class="login-input" placeholder="Enter Admin Key">
    <button id="login-btn">Login</button>
    <div id="login-error" class="error-message"></div>
  </div>

  <div id="admin-panel" style="display: none;">
    <h1>ğŸ›  BD Clan Admin Panel</h1>

    <label for="player-select">ğŸ‘¥ Select Player:</label>
    <select id="player-select" style="margin: 10px 0;"></select><br />

    <button id="ban-btn">ğŸš« Ban</button>
    <button id="timeout-btn">â³ Timeout 1hr</button>
    <button id="kill-btn">ğŸ’€ Add Kill</button>

    <hr />

    <h2>ğŸ“£ Send Announcement</h2>
    <input id="announcement-input" placeholder="Message..." style="width: 60%;" />
    <button id="announce-btn">Send</button>

    <hr />

    <h2>ğŸ Global Gift</h2>
    <button id="gift-btn">Send 1000 Gold to All</button>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBDgadn_l0VLJmgCPzziGbwbXYaIfhn0vQ",
      authDomain: "aoh-bd-clan.firebaseapp.com",
      databaseURL: "https://aoh-bd-clan-default-rtdb.firebaseio.com/",
      projectId: "aoh-bd-clan",
      storageBucket: "aoh-bd-clan.firebasestorage.app",
      messagingSenderId: "824398865971",
      appId: "1:824398865971:web:139890878f47e251ad6546",
      measurementId: "G-4V15NCH2RH"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // DOM elements
    const loginContainer = document.getElementById('login-container');
    const adminPanel = document.getElementById('admin-panel');
    const loginBtn = document.getElementById('login-btn');
    const adminKeyInput = document.getElementById('admin-key');
    const loginError = document.getElementById('login-error');

    // Check admin credentials
    function checkAdminKey(key) {
      return new Promise((resolve, reject) => {
        database.ref('adminKey').once('value')
          .then(snapshot => {
            if (snapshot.exists() && snapshot.val() === key) {
              resolve(true);
            } else {
              resolve(false);
            }
          })
          .catch(error => {
            console.error("Error checking admin key:", error);
            reject(error);
          });
      });
    }

    // Load players
    function loadPlayers() {
      return new Promise((resolve, reject) => {
        database.ref('players').once('value')
          .then(snapshot => {
            const select = document.getElementById("player-select");
            select.innerHTML = "";
            
            if (snapshot.exists()) {
              snapshot.forEach((childSnapshot) => {
                const opt = document.createElement("option");
                opt.value = childSnapshot.key;
                opt.textContent = childSnapshot.val().name || childSnapshot.key;
                select.appendChild(opt);
              });
              resolve();
            } else {
              loginError.textContent = "No players found";
              reject("No players found");
            }
          })
          .catch(error => {
            console.error("Error loading players:", error);
            loginError.textContent = "Failed to load players";
            reject(error);
          });
      });
    }

    // Admin actions
    async function banPlayer() {
      const id = document.getElementById("player-select").value;
      try {
        await database.ref(`players/${id}/isBanned`).set(true);
        alert("Player banned successfully");
      } catch (error) {
        console.error("Error banning player:", error);
        alert("Failed to ban player");
      }
    }

    async function timeoutPlayer() {
      const id = document.getElementById("player-select").value;
      const oneHourLater = new Date(Date.now() + 3600000).toISOString();
      try {
        await database.ref(`players/${id}/bannedUntil`).set(oneHourLater);
        alert("Player timed out for 1 hour");
      } catch (error) {
        console.error("Error timing out player:", error);
        alert("Failed to timeout player");
      }
    }

    async function sendAnnouncement() {
      const msg = document.getElementById("announcement-input").value.trim();
      if (!msg) {
        alert("Please enter a message");
        return;
      }
      
      try {
        await database.ref("announcements").push({
          message: msg,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        alert("Announcement sent successfully");
        document.getElementById("announcement-input").value = "";
      } catch (error) {
        console.error("Error sending announcement:", error);
        alert("Failed to send announcement");
      }
    }

    async function giftAll() {
      if (!confirm("Send 1000 gold to all players?")) return;
      
      try {
        const snapshot = await database.ref("players").once("value");
        if (snapshot.exists()) {
          const updates = {};
          snapshot.forEach(child => {
            updates[`${child.key}/gold`] = firebase.database.ServerValue.increment(1000);
          });
          await database.ref("players").update(updates);
          alert("Gift sent to all players");
        } else {
          alert("No players found");
        }
      } catch (error) {
        console.error("Error sending gift:", error);
        alert("Failed to send gift");
      }
    }

    async function addKill() {
      const id = document.getElementById("player-select").value;
      try {
        await database.ref(`players/${id}/kills`).set(firebase.database.ServerValue.increment(1));
        alert("Kill added successfully");
      } catch (error) {
        console.error("Error adding kill:", error);
        alert("Failed to add kill");
      }
    }

    // Initialize the admin panel
    async function initAdminPanel() {
      try {
        await loadPlayers();
        
        document.getElementById("ban-btn").onclick = banPlayer;
        document.getElementById("timeout-btn").onclick = timeoutPlayer;
        document.getElementById("announce-btn").onclick = sendAnnouncement;
        document.getElementById("gift-btn").onclick = giftAll;
        document.getElementById("kill-btn").onclick = addKill;
        
        loginContainer.style.display = "none";
        adminPanel.style.display = "block";
      } catch (error) {
        console.error("Admin panel initialization failed:", error);
      }
    }

    // Login button handler
    loginBtn.addEventListener('click', async () => {
      const key = adminKeyInput.value.trim();
      if (!key) {
        loginError.textContent = "Please enter an admin key";
        return;
      }
      
      try {
        const isValid = await checkAdminKey(key);
        if (isValid) {
          await initAdminPanel();
        } else {
          loginError.textContent = "Invalid admin key";
        }
      } catch (error) {
        loginError.textContent = "Authentication failed. Please try again.";
        console.error("Authentication error:", error);
      }
    });

    // Allow pressing Enter to login
    adminKeyInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        loginBtn.click();
      }
    });
  </script>
</body>
</html>
